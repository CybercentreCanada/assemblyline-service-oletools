name: Oletools
version: 1
description: >-
  This service extracts metadata, network information and reports anomalies in
  Microsoft OLE and XML documents using the Python library py-oletools by Philippe
  Lagadec - http://www.decalage.info.

accepts: document/office/.*|code/xml
rejects: empty|metadata/.*

stage: CORE
category: Static Analysis

file_required: true
timeout: 60
disable_cache: false

enabled: true
is_external: false
licence_count: 0

config:
  macro_score_max_file_size: 5242880  # 5 * 1024**2
  macro_score_min_alert: 0.6
  metadata_size_to_extract: 500

heuristics:
  - heur_id: 1
    name: Attached Document Template
    score:
    filetype: document/office
    description: >-
      Attached template specified in xml relationships (pointing to external source).
      This can be used for malicious purposes.

  - heur_id: 2
    name: Multi-embedded documents
    score:
    filetype: document/office
    description: >-
      File contains both old OLE format and new ODF format. This can be
      used to obfuscate malicious content.

  - heur_id: 3
    name: Massive document
    score:
    filetype: document/office
    description: >-
      File contains parts which are massive. Could not scan entire document.

  - heur_id: 4
    name: Pcode and macros content differ
    score: 500
    filetype: document/office
    description: >-
      all_pcode dump contains suspicious content not in all_vba dump. Indicates
      possible VBA stomping.

  - heur_id: 5
    name: Flash content in OLE
    score:
    filetype: document/office/ole
    description: Flash object detected in OLE stream.

  - heur_id: 6
    name: Hex content in OLE
    score:
    filetype: document/office/ole
    description: Found large chunk of VBA hex notation in OLE.

  - heur_id: 7
    name: IOC in XML
    score:
    filetype: document/office
    description: IOC content discovered in compressed XML.

  - heur_id: 8
    name: B64 in XML
    score:
    filetype: document/office
    description: Base64 content discovered in compressed XML.

  - heur_id: 9
    name: IOC in OLE
    score:
    filetype: document/office
    description: IOC content discovered in OLE Object.

  - heur_id: 10
    name: B64 in OLE
    score:
    filetype: document/office
    description: Base64 content discovered in OLE Object.

  - heur_id: 11
    name: Suspicious Embedded RTF
    score: 1000
    filetype: document/office
    description: Malicious properties discovered in embedded RTF object(s).

  - heur_id: 12
    name: Suspicious Embedded Link
    score: 1000
    filetype: document/office
    description: Malicious properties discovered in embedded link object(s).

  - heur_id: 12a
    name: Linked Object
    score: 10
    filetype: document/office
    description: Malicious properties discovered in embedded link object(s).

  - heur_id: 13
    name: Suspicious Unknown Object
    score:
    filetype: document/office
    description: Malicious properties discovered in embedded object(s) of unknown type.

  - heur_id: 14
    name: DDE Link Extracted
    score:
    filetype: document/office
    description: DDE link object extracted.

  - heur_id: 15
    name: Suspicious DDE Link
    score:
    filetype: document/office
    description: Suspicious properties discovered in DDE link object.

  - heur_id: 16
    name: Large Metadata Extracted
    score:
    filetype: document/office
    description: Large metadata content extracted for analysis.

  - heur_id: 17
    name: Thumbnail Extracted
    score:
    filetype: document/office
    description: Embedded thumbnail from OLE metadata extracted.

  - heur_id: 18
    name: Large malformed OLE Object Extracted
    score:
    filetype: document/office
    description: Large malformed OLE object extracted from sample.

docker_config:
  image: cccs/assemblyline-service-oletools:latest
  cpu_cores: 0.5
  ram_mb: 1024

update_config:
  generates_signatures: true
  method: run
  run_options:
    allow_internet_access: true
    command: ["python", "-m", "yara_.yara_updater"]
    image: cccs/assemblyline-service-yara:latest
  update_interval_seconds: 3600